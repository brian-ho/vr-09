"use strict";
// make data test
var scene = d3.select("a-scene");

// for analysis grid
// var positions = [
//{x:-10.585386, y:3.907352, z:-26.740781},{x:-12.476403, y:3.907414, z:-26.089588},{x:-14.367421, y:3.907476, z:-25.438394},{x:-16.258438, y:3.907538, z:-24.787201},{x:-18.149456, y:3.9076, z:-24.136008},{x:-20.040473, y:3.907662, z:-23.484814},{x:-21.931491, y:3.907724, z:-22.833621},{x:-23.822508, y:3.907786, z:-22.182427},{x:-25.713526, y:3.907848, z:-21.531234},{x:-6.597168, y:3.907352, z:-15.158181},{x:-8.488185, y:3.907414, z:-14.506988},{x:-10.379203, y:3.907476, z:-13.855795},{x:-12.27022, y:3.907538, z:-13.204601},{x:-14.161238, y:3.9076, z:-12.553408},{x:-16.052255, y:3.907662, z:-11.902214},{x:-17.943273, y:3.907724, z:-11.251021},{x:-19.83429, y:3.907786, z:-10.599828},{x:-21.725308, y:3.907848, z:-9.948634},{x:-7.166913, y:3.907352, z:-16.812838},{x:-9.057931, y:3.907414, z:-16.161645},{x:-10.948948, y:3.907476, z:-15.510452},{x:-12.839966, y:3.907538, z:-14.859258},{x:-14.730983, y:3.9076, z:-14.208065},{x:-16.622001, y:3.907662, z:-13.556872},{x:-18.513018, y:3.907724, z:-12.905678},{x:-20.404036, y:3.907786, z:-12.254485},{x:-22.295053, y:3.907848, z:-11.603291},{x:-7.736658, y:3.907352, z:-18.467496},{x:-9.627676, y:3.907414, z:-17.816302},{x:-11.518693, y:3.907476, z:-17.165109},{x:-13.409711, y:3.907538, z:-16.513915},{x:-15.300728, y:3.9076, z:-15.862722},{x:-17.191746, y:3.907662, z:-15.211529},{x:-19.082763, y:3.907724, z:-14.560335},{x:-20.973781, y:3.907786, z:-13.909142},{x:-22.864798, y:3.907848, z:-13.257949},{x:-8.306404, y:3.907352, z:-20.122153},{x:-10.197421, y:3.907414, z:-19.470959},{x:-12.088439, y:3.907476, z:-18.819766},{x:-13.979456, y:3.907538, z:-18.168572},{x:-15.870474, y:3.9076, z:-17.517379},{x:-17.761491, y:3.907662, z:-16.866186},{x:-19.652509, y:3.907724, z:-16.214992},{x:-21.543526, y:3.907786, z:-15.563799},{x:-23.434544, y:3.907848, z:-14.912606},{x:-8.876149, y:3.907352, z:-21.77681},{x:-10.767167, y:3.907414, z:-21.125616},{x:-12.658184, y:3.907476, z:-20.474423},{x:-14.549202, y:3.907538, z:-19.82323},{x:-16.440219, y:3.9076, z:-19.172036},{x:-18.331237, y:3.907662, z:-18.520843},{x:-20.222254, y:3.907724, z:-17.869649},{x:-22.113272, y:3.907786, z:-17.218456},{x:-24.004289, y:3.907848, z:-16.567263},{x:-9.445895, y:3.907352, z:-23.431467},{x:-11.336912, y:3.907414, z:-22.780273},{x:-13.22793, y:3.907476, z:-22.12908},{x:-15.118947, y:3.907538, z:-21.477887},{x:-17.009965, y:3.9076, z:-20.826693},{x:-18.900982, y:3.907662, z:-20.1755},{x:-20.792, y:3.907724, z:-19.524307},{x:-22.683017, y:3.907786, z:-18.873113},{x:-24.574035, y:3.907848, z:-18.22192},{x:-10.01564, y:3.907352, z:-25.086124},{x:-11.906658, y:3.907414, z:-24.434931},{x:-13.797675, y:3.907476, z:-23.783737},{x:-15.688693, y:3.907538, z:-23.132544},{x:-17.57971, y:3.9076, z:-22.48135},{x:-19.470728, y:3.907662, z:-21.830157},{x:-21.361745, y:3.907724, z:-21.178964},{x:-23.252763, y:3.907786, z:-20.52777},{x:-25.14378, y:3.907848, z:-19.876577},{x:-25.14378, y:5.657848, z:-19.876577},{x:-23.252763, y:5.657786, z:-20.52777},{x:-21.361745, y:5.657724, z:-21.178964},{x:-19.470728, y:5.657662, z:-21.830157},{x:-17.57971, y:5.6576, z:-22.48135},{x:-15.688693, y:5.657538, z:-23.132544},{x:-13.797675, y:5.657476, z:-23.783737},{x:-11.906658, y:5.657414, z:-24.434931},{x:-10.01564, y:5.657352, z:-25.086124},{x:-24.574035, y:5.657848, z:-18.22192},{x:-22.683017, y:5.657786, z:-18.873113},{x:-20.792, y:5.657724, z:-19.524307},{x:-18.900982, y:5.657662, z:-20.1755},{x:-17.009965, y:5.6576, z:-20.826693},{x:-15.118947, y:5.657538, z:-21.477887},{x:-13.22793, y:5.657476, z:-22.12908},{x:-11.336912, y:5.657414, z:-22.780273},{x:-9.445895, y:5.657352, z:-23.431467},{x:-24.004289, y:5.657848, z:-16.567263},{x:-22.113272, y:5.657786, z:-17.218456},{x:-20.222254, y:5.657724, z:-17.869649},{x:-18.331237, y:5.657662, z:-18.520843},{x:-16.440219, y:5.6576, z:-19.172036},{x:-14.549202, y:5.657538, z:-19.82323},{x:-12.658184, y:5.657476, z:-20.474423},{x:-10.767167, y:5.657414, z:-21.125616},{x:-8.876149, y:5.657352, z:-21.77681},{x:-23.434544, y:5.657848, z:-14.912606},{x:-21.543526, y:5.657786, z:-15.563799},{x:-19.652509, y:5.657724, z:-16.214992},{x:-17.761491, y:5.657662, z:-16.866186},{x:-15.870474, y:5.6576, z:-17.517379},{x:-13.979456, y:5.657538, z:-18.168572},{x:-12.088439, y:5.657476, z:-18.819766},{x:-10.197421, y:5.657414, z:-19.470959},{x:-8.306404, y:5.657352, z:-20.122153},{x:-22.864798, y:5.657848, z:-13.257949},{x:-20.973781, y:5.657786, z:-13.909142},{x:-19.082763, y:5.657724, z:-14.560335},{x:-17.191746, y:5.657662, z:-15.211529},{x:-15.300728, y:5.6576, z:-15.862722},{x:-13.409711, y:5.657538, z:-16.513915},{x:-11.518693, y:5.657476, z:-17.165109},{x:-9.627676, y:5.657414, z:-17.816302},{x:-7.736658, y:5.657352, z:-18.467496},{x:-22.295053, y:5.657848, z:-11.603291},{x:-20.404036, y:5.657786, z:-12.254485},{x:-18.513018, y:5.657724, z:-12.905678},{x:-16.622001, y:5.657662, z:-13.556872},{x:-14.730983, y:5.6576, z:-14.208065},{x:-12.839966, y:5.657538, z:-14.859258},{x:-10.948948, y:5.657476, z:-15.510452},{x:-9.057931, y:5.657414, z:-16.161645},{x:-7.166913, y:5.657352, z:-16.812838},{x:-21.725308, y:5.657848, z:-9.948634},{x:-19.83429, y:5.657786, z:-10.599828},{x:-17.943273, y:5.657724, z:-11.251021},{x:-16.052255, y:5.657662, z:-11.902214},{x:-14.161238, y:5.6576, z:-12.553408},{x:-12.27022, y:5.657538, z:-13.204601},{x:-10.379203, y:5.657476, z:-13.855795},{x:-8.488185, y:5.657414, z:-14.506988},{x:-6.597168, y:5.657352, z:-15.158181},{x:-25.713526, y:5.657848, z:-21.531234},{x:-23.822508, y:5.657786, z:-22.182427},{x:-21.931491, y:5.657724, z:-22.833621},{x:-20.040473, y:5.657662, z:-23.484814},{x:-18.149456, y:5.6576, z:-24.136008},{x:-16.258438, y:5.657538, z:-24.787201},{x:-14.367421, y:5.657476, z:-25.438394},{x:-12.476403, y:5.657414, z:-26.089588},{x:-10.585386, y:5.657352, z:-26.740781},{x:-10.585386, y:7.407352, z:-26.740781},{x:-12.476403, y:7.407414, z:-26.089588},{x:-14.367421, y:7.407476, z:-25.438394},{x:-16.258438, y:7.407538, z:-24.787201},{x:-18.149456, y:7.4076, z:-24.136008},{x:-20.040473, y:7.407662, z:-23.484814},{x:-21.931491, y:7.407724, z:-22.833621},{x:-23.822508, y:7.407786, z:-22.182427},{x:-25.713526, y:7.407848, z:-21.531234},{x:-6.597168, y:7.407352, z:-15.158181},{x:-8.488185, y:7.407414, z:-14.506988},{x:-10.379203, y:7.407476, z:-13.855795},{x:-12.27022, y:7.407538, z:-13.204601},{x:-14.161238, y:7.4076, z:-12.553408},{x:-16.052255, y:7.407662, z:-11.902214},{x:-17.943273, y:7.407724, z:-11.251021},{x:-19.83429, y:7.407786, z:-10.599828},{x:-21.725308, y:7.407848, z:-9.948634},{x:-7.166913, y:7.407352, z:-16.812838},{x:-9.057931, y:7.407414, z:-16.161645},{x:-10.948948, y:7.407476, z:-15.510452},{x:-12.839966, y:7.407538, z:-14.859258},{x:-14.730983, y:7.4076, z:-14.208065},{x:-16.622001, y:7.407662, z:-13.556872},{x:-18.513018, y:7.407724, z:-12.905678},{x:-20.404036, y:7.407786, z:-12.254485},{x:-22.295053, y:7.407848, z:-11.603291},{x:-7.736658, y:7.407352, z:-18.467496},{x:-9.627676, y:7.407414, z:-17.816302},{x:-11.518693, y:7.407476, z:-17.165109},{x:-13.409711, y:7.407538, z:-16.513915},{x:-15.300728, y:7.4076, z:-15.862722},{x:-17.191746, y:7.407662, z:-15.211529},{x:-19.082763, y:7.407724, z:-14.560335},{x:-20.973781, y:7.407786, z:-13.909142},{x:-22.864798, y:7.407848, z:-13.257949},{x:-8.306404, y:7.407352, z:-20.122153},{x:-10.197421, y:7.407414, z:-19.470959},{x:-12.088439, y:7.407476, z:-18.819766},{x:-13.979456, y:7.407538, z:-18.168572},{x:-15.870474, y:7.4076, z:-17.517379},{x:-17.761491, y:7.407662, z:-16.866186},{x:-19.652509, y:7.407724, z:-16.214992},{x:-21.543526, y:7.407786, z:-15.563799},{x:-23.434544, y:7.407848, z:-14.912606},{x:-8.876149, y:7.407352, z:-21.77681},{x:-10.767167, y:7.407414, z:-21.125616},{x:-12.658184, y:7.407476, z:-20.474423},{x:-14.549202, y:7.407538, z:-19.82323},{x:-16.440219, y:7.4076, z:-19.172036},{x:-18.331237, y:7.407662, z:-18.520843},{x:-20.222254, y:7.407724, z:-17.869649},{x:-22.113272, y:7.407786, z:-17.218456},{x:-24.004289, y:7.407848, z:-16.567263},{x:-9.445895, y:7.407352, z:-23.431467},{x:-11.336912, y:7.407414, z:-22.780273},{x:-13.22793, y:7.407476, z:-22.12908},{x:-15.118947, y:7.407538, z:-21.477887},{x:-17.009965, y:7.4076, z:-20.826693},{x:-18.900982, y:7.407662, z:-20.1755},{x:-20.792, y:7.407724, z:-19.524307},{x:-22.683017, y:7.407786, z:-18.873113},{x:-24.574035, y:7.407848, z:-18.22192},{x:-10.01564, y:7.407352, z:-25.086124},{x:-11.906658, y:7.407414, z:-24.434931},{x:-13.797675, y:7.407476, z:-23.783737},{x:-15.688693, y:7.407538, z:-23.132544},{x:-17.57971, y:7.4076, z:-22.48135},{x:-19.470728, y:7.407662, z:-21.830157},{x:-21.361745, y:7.407724, z:-21.178964},{x:-23.252763, y:7.407786, z:-20.52777},{x:-25.14378, y:7.407848, z:-19.876577}
//]


// create responsive HVAC

var hvacData = ['A0', 'A1', 'A2', 'A3', 'A', 'B0', 'B1', 'B2', 'B3', 'B', 'C0', 'C1', 'C2', 'C3', 'C', 'D0', 'D1', 'D2', 'D3', 'D', 'E'];
var numbers = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20, 21];
var sample;

var gWidth = 200;
var gHeight = 100;

var holder = d3.select("#interface")
    .append("svg")
    .attr("width", 250)
    .attr("height", 250);

var xScale = d3.scaleLinear()
    .domain([0, 21])
    .range([0, gWidth]);

var yScale = d3.scaleLinear()
    .domain([0, 20])
    .range([gHeight, 0]);

// create the generate axis functions
var xAxis = d3.axisBottom()
    .scale(xScale)
    .ticks(0);

var yAxis = d3.axisRight()
    .scale(yScale)
    .tickValues([0, 5, 10, 15, 20])
    //.tickFormat(d3.format(".0%"))
    .tickSize(gWidth);
/*
holder.append("path")
    .data(numbers, function(d, i) {return d, i})
    .attr("class", "line")
    .attr("d", d3.line()
        .xScale(function(d) { return xScale(i); })
        .yScale(function(d) { return yScale(d); }));
*/

holder.append("g")
    .attr("class", "axis")
    .attr("id", "x")
    .attr("transform", "translate(5 150)")
    .call(xAxis);

var gy = holder.append("g")
    .attr("class", "axis")
    .attr("id", "y")
    .attr("transform", "translate(5 100)")
    .call(yAxis);

gy.selectAll("g").filter(function(d) { return d; })
    .classed("minor", true);

gy.selectAll("text")
    .attr("x", 0)
    .attr("dy", -4);

var vents = scene.selectAll("a-obj-model.hvac").data(hvacData, function(d) {return d})

vents.enter().append("a-obj-model")
  .classed("hvac", true)
  .merge(vents)
  .attrs({
      src: function (d) {return "#MKT-" + d},
      //color: function (d, i) {return d3.interpolateInferno(map(numbers[i], 0, 20, 0, 1))},
      opacity: 0.5
      })
  .on("mouseenter", function(d, i) {
      if(this.hovering) return;
      this.hovering = true;
      d3.select("#thingName").text(function () {return "HVAC_" + d + " " + sample[i]});
      d3.select(this).transition().duration(200)
        .attrs({
            color: "white",
            opacity: 1
          })
        })
  .on("mouseleave", function(d, i) {
      this.hovering = false;
            d3.select("#thingName").text(function () {return "..."});
      d3.select(this).transition().duration(200)
        .attrs({
            //color: function () {return d3.interpolateInferno(map(numbers[i], 0, 20, 0, 1))},
            opacity: 0.5
          })
        });

update(numbers)

function update(data) {
  console.log("FIRING " + data);

  scene.selectAll("a-obj-model.hvac").transition().duration(5000).ease(d3.easeLinear)
    .attr('color', function (d, i) {return d3.interpolateCool(map(data[i], 0, hvacData.length, 0, 1))})
}

scene.selectAll(".structure").attrs({
      color: "grey",
      opacity: .85
    });

// adjust static class properties
scene.selectAll(".bldg").attrs({
      color: "grey",
      opacity: .85
    });

scene.selectAll(".shell").attrs({
      color: "#444",
      opacity: 1
    });

scene.selectAll(".roof").attrs({
      color: "#444",
      opacity: 1
    });

d3.interval(function() {
      sample = d3.shuffle(numbers);
      //console.log(sample);
      //.sort(function(a, b) {return a - b});
      update(sample);
  }, 3000);

function map(value, low1, high1, low2, high2) {
    return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
}

/*update(positions);

function update(data) {

var points = scene.selectAll("a-sphere").data(data, function(d) { return d; });

points.enter().append("a-sphere")
.attrs({
  position: function(d) {
    var x=d.x+16;
    var y=d.y;
    var z=d.z+16;
    return x + " " + y + " " + z
    },
  radius: .125,
  color: function(d, i) {
    return d3.interpolateCool(map(i, 0, 216, 0, 1))}
});
}*/

//var points = scene.selectAll("a-sphere").data()

/*
function update(data) {
  var t = d3.transition()
      .duration(5000)
      .ease(d3.easeLinear);

  // DATA JOIN
  // Join new data with old emements, if any
  var shapes = scene.selectAll("a-box").data(data, function(d) { return d; });

  // EXIT
  // Remove old elements as needed.
  shapes.exit()
      .transition(t)
        .attrs({
          opacity: 0.01,
          color: "#262626"
          })
          .attrTween("position", function(d, i){
              var u = this.getAttribute("position").x;
              var v = this.getAttribute("position").z;
              var k = this.getAttribute("position").y;
              return d3.interpolateObject({x:u, y:k, z:v}, {x:u, y:-d, z:v})
          })
        .remove();

  // UPDATE
  // Update old elements as needed.
  shapes  .transition(t)
        .attr("color", function(d, i) {
            var n = sample.length;
            return d3.interpolateInferno(map(i, 1, n, 0, 1));
          })
        .attrTween("position", function(d, i) {
            var j = this.getAttribute("position");
            var k = this.getAttribute("position").y;
            var u = spread * Math.ceil((i+1)/5);
            var v = spread * ((i) % 5);
            return d3.interpolateObject(j,{x:u, y:k, z:v})
          });

  // ENTER
  // Create new elements as needed
  shapes.enter().append("a-box")
        .attrs({
            height: function(d) {return map(d, 1, 25, .1, 3)},
            opacity: 0.01,
            color: "#fff"
          })
        .transition(t)
          .attr("opacity", 1)
          .attrTween("position", function(d, i){
              var u = spread * Math.ceil((i+1)/5);
              var v = spread * (i % 5);
              var h = this.getAttribute("height");
              return d3.interpolateObject({x:u, y:d*5, z:v},{x:u, y:h/2, z:v})
            });
  }

// The initial display
update(numbers)

d3.interval(function() {
      sample = d3.shuffle(numbers).slice(0, Math.floor(Math.random()*25))
      //.sort(function(a, b) {return a - b});
      update(sample);
  }, 8000);

function map(value, low1, high1, low2, high2) {
    return low2 + (high2 - low2) * (value - low1) / (high1 - low1);
}
*/
